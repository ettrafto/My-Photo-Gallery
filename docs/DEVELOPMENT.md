# Development Guide

**Last Updated**: 2025-01-XX

This guide covers local development setup, common workflows, and project structure.

> ðŸ“š **See also**: [Configuration Guide](CONFIGURATION.md) | [Architecture Guide](ARCHITECTURE.md) | [README](../README.md)

---

## Local Development Setup

### Prerequisites

- Node.js 18+ (check with `node --version`)
- npm (comes with Node.js)

### Initial Setup

```bash
# Install dependencies
npm install

# Start development server
npm run dev
```

The dev server runs at `http://localhost:5173` (default Vite port).

---

## Project Structure

```
Photo-Log/
â”œâ”€â”€ content/                    # Generated/managed JSON data
â”‚   â”œâ”€â”€ site/
â”‚   â”‚   â””â”€â”€ site.json          # Site configuration (see CONFIGURATION.md)
â”‚   â”œâ”€â”€ albums.json            # Master album index (auto-generated)
â”‚   â”œâ”€â”€ albums/                # Individual album JSON files (auto-generated)
â”‚   â”‚   â””â”€â”€ {slug}.json
â”‚   â”œâ”€â”€ trips/                 # Trip JSON files (manual)
â”‚   â”‚   â””â”€â”€ {slug}.json
â”‚   â”œâ”€â”€ map.json               # Photo location index (auto-generated)
â”‚   â””â”€â”€ album-locations.json   # Manual album location fallbacks (optional)
â”‚
â”œâ”€â”€ public/                    # Static assets
â”‚   â”œâ”€â”€ images/                # Legacy image location (used by scan.mjs)
â”‚   â””â”€â”€ photos/                # Processed images (generated by importPhotos.mjs)
â”‚
â”œâ”€â”€ photo-source/              # Source photos (your originals)
â”‚   â””â”€â”€ originals/             # Put original photos here
â”‚       â””â”€â”€ {album-name}/
â”‚           â”œâ”€â”€ _album.json    # Album metadata (optional)
â”‚           â””â”€â”€ *.JPG, *.jpg, etc.
â”‚
â”œâ”€â”€ scripts/                   # Build/processing scripts
â”‚   â”œâ”€â”€ scan.mjs               # Legacy: scans public/images/ and generates JSON
â”‚   â”œâ”€â”€ importPhotos.mjs       # Modern: processes photo-source/originals/
â”‚   â”œâ”€â”€ processPhotos.mjs      # Image processing (Sharp) utility
â”‚   â”œâ”€â”€ new-album.mjs          # Interactive album creation helper
â”‚   â”œâ”€â”€ initAlbumLocations.mjs # Initialize album location config
â”‚   â””â”€â”€ copy-content.mjs       # Copy content/ to dist/ during build
â”‚
â”œâ”€â”€ src/                       # React application source
â”‚   â”œâ”€â”€ components/            # React components
â”‚   â”œâ”€â”€ pages/                 # Page components (routes)
â”‚   â”œâ”€â”€ hooks/                 # React hooks
â”‚   â”œâ”€â”€ lib/                   # Utilities and config loaders
â”‚   â”œâ”€â”€ data/                  # Static data (trip slugs, etc.)
â”‚   â”œâ”€â”€ utils/                 # Helper functions
â”‚   â””â”€â”€ App.jsx                # Root component and routing
â”‚
â””â”€â”€ dist/                      # Production build output (generated)
```

---

## Common Workflows

### Adding Photos

**Recommended workflow (modern):**

1. Place original photos in `photo-source/originals/{album-name}/`
2. Optionally create `_album.json` metadata file in the album folder
3. Run `npm run import:photos` to:
   - Process images (resize, convert to WebP)
   - Extract EXIF data
   - Generate album JSON files
   - Update albums.json index

**Legacy workflow (still supported):**

1. Place photos in `public/images/{album-name}/`
2. Optionally create `_album.json` metadata file
3. Run `npm run scan` to generate JSON manifests

### Creating a New Album

**Option 1: Interactive helper**

```bash
npm run new-album
```

Follow prompts to create album folder and metadata file.

**Option 2: Manual**

1. Create folder: `photo-source/originals/my-album/` (or `public/images/my-album/`)
2. Create `_album.json` (optional):

```json
{
  "title": "My Album",
  "description": "Album description",
  "tags": ["tag1", "tag2"],
  "date": "2025-01-15"
}
```

3. Add photos to the folder
4. Run `npm run import:photos` (or `npm run scan` for legacy workflow)

### Creating a Trip

1. Create trip JSON file: `content/trips/my-trip-2024.json`
2. Add trip slug to registry: Edit `src/data/trips.js`:

```javascript
export const TRIP_SLUGS = ['western-parks-2025', 'my-trip-2024'];
```

3. See `docs/TRIPS-GUIDE.md` (or CONFIGURATION.md) for trip JSON schema
4. Build: `npm run build`

### Setting Up Album Locations (Map Feature)

1. Initialize location config:

```bash
npm run init-locations
```

2. Edit `content/album-locations.json` to add coordinates for albums without GPS EXIF data
3. Run `npm run scan` or `npm run import:photos` to regenerate map.json with location inference

---

## Available Scripts

### `npm run dev`

Starts Vite development server with hot module replacement.

- URL: `http://localhost:5173`
- Hot reload: Enabled
- Source maps: Enabled

### `npm run build`

Production build pipeline:

1. Runs `import:photos` to process images and generate JSON
2. Runs `vite build` to bundle React app
3. Runs `copy-content.mjs` to copy `content/` to `dist/content/`

Output: `dist/` folder ready for deployment.

### `npm run preview`

Preview production build locally. Must run `npm run build` first.

### `npm run scan`

**Legacy script** - Scans `public/images/` and generates JSON manifests.

- Reads all album folders in `public/images/`
- Extracts EXIF data from images
- Generates `content/albums.json` and `content/albums/{slug}.json`
- Generates `content/map.json` (with location inference if configured)

**Note**: Prefer `npm run import:photos` for new workflows.

### `npm run import:photos`

**Modern script** - Processes photos from `photo-source/originals/`.

- Processes images with Sharp (resize, convert to WebP)
- Extracts EXIF data
- Generates optimized images in `public/photos/`
- Generates JSON manifests in `content/`

**Usage:**

```bash
# Process all albums
npm run import:photos

# Process specific album
npm run import:photos -- --album my-album-name

# Process with custom settings
npm run import:photos -- --album my-album --quality 85
```

### `npm run new-album`

Interactive helper to create a new album folder and metadata file.

Prompts for:
- Album folder name
- Title (optional)
- Description (optional)
- Tags (optional)
- Date (optional)

### `npm run init-locations`

Generates or updates `content/album-locations.json` with placeholder entries for all albums.

After running, manually edit the file to add GPS coordinates for albums that don't have EXIF GPS data.

### `npm run lint`

Runs ESLint to check code quality.

---

## Troubleshooting

### Albums not showing?

- Ensure images exist in the album folder (not just `_album.json`)
- Run `npm run scan` or `npm run import:photos` after adding images
- Check browser console for errors
- Verify JSON files were generated in `content/albums/`

### EXIF data missing?

- Some images don't have EXIF (screenshots, heavily edited photos)
- Ensure images weren't stripped of metadata during editing
- Check console for EXIF parsing errors

### Build fails?

- Clear `node_modules` and reinstall: `rm -rf node_modules && npm install`
- Clear Vite cache: `rm -rf .vite` (or `.vite` folder on Windows)
- Ensure all dependencies are installed: `npm ci`

### Images not loading in production?

- Ensure `content/` folder is copied to `dist/` (handled by build script)
- Check that image paths in JSON are correct
- Verify images exist in `public/photos/` or `public/images/`
- Check browser network tab for 404 errors

### Changes not appearing?

- Re-run `npm run scan` or `npm run import:photos` after modifying images/metadata
- Clear browser cache or hard refresh (Ctrl+Shift+R / Cmd+Shift+R)
- Restart dev server

### Theme not applying?

- Check `content/site/site.json` has valid `theme.name` ("mono" or "paper")
- Verify theme CSS files exist
- Check browser console for warnings

---

## Image Processing Pipeline

The project supports two image workflows:

### Modern Pipeline (`import:photos`)

1. **Source**: `photo-source/originals/{album}/`
2. **Processing**: Sharp library processes images
   - Resizes to multiple sizes (large, small)
   - Converts to WebP format
   - Generates blur placeholders
   - Preserves EXIF metadata
3. **Output**: `public/photos/{album}/{filename}-{size}.webp`
4. **JSON**: Generated with paths pointing to optimized images

### Legacy Pipeline (`scan`)

1. **Source**: `public/images/{album}/`
2. **Processing**: Direct EXIF extraction, no image optimization
3. **Output**: Original images remain in place
4. **JSON**: Generated with paths pointing to original images

**Recommendation**: Use modern pipeline for new albums. Legacy pipeline is maintained for backward compatibility.

---

## Configuration Files

### `content/site/site.json`

Site-wide configuration (title, nav, SEO, hero, theme).

**See**: `docs/CONFIGURATION.md` for complete reference.

### `src/data/trips.js`

Registry of trip slugs. Must match JSON filenames in `content/trips/`.

```javascript
export const TRIP_SLUGS = ['western-parks-2025', 'another-trip'];
```

### `content/album-locations.json`

Manual GPS coordinates for albums (used when EXIF GPS data is missing).

**See**: `docs/ALBUM-LOCATIONS-GUIDE.md` for details (if preserved) or CONFIGURATION.md.

---

## Development Tips

### Hot Reload

- React components: Hot reload works automatically
- JSON files: Changes require page refresh
- CSS: Hot reload works automatically
- Config changes: Refresh page to reload `site.json`

### Debugging

- Check browser console for errors
- Check Network tab for failed requests
- Check React DevTools for component state
- Check generated JSON files in `content/` to verify data

### Performance

- Development: Source maps enabled, no minification
- Production: Minified, tree-shaken, optimized assets
- Images: Lazy-loaded by default (see `LazyImage` component)

---

## Git Workflow

### What to Commit

- Source code (`src/`)
- Configuration (`content/site/site.json`, `content/trips/*.json`, `content/album-locations.json`)
- Scripts (`scripts/`)
- Package files (`package.json`, `package-lock.json`)
- Documentation (`docs/`, `README.md`)

### What NOT to Commit

- `node_modules/` (use `.gitignore`)
- `dist/` (generated build)
- `content/albums.json` (auto-generated)
- `content/albums/*.json` (auto-generated)
- `content/map.json` (auto-generated)
- `public/photos/` (generated images)
- `.vite/` (cache)

### Recommended `.gitignore`

```
node_modules/
dist/
.vite/
public/photos/
content/albums.json
content/albums/*.json
content/map.json
```

**Note**: Keep `content/site/`, `content/trips/`, and `content/album-locations.json` in git.

---

## Next Steps

- See [Configuration Guide](CONFIGURATION.md) for configuration options
- See [Architecture Guide](ARCHITECTURE.md) for system architecture
- See [README](../README.md) for project overview
