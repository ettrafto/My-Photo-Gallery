# Configuration Schema

## Overview

All site configuration is stored as JSON files in the `content/` directory. These files can be manually edited or generated by build scripts. Scripts preserve manual edits and never overwrite custom data.

**Key Principles:**
- Required fields must be present and correct type
- Optional fields have defaults (see `src/lib/siteConfig.js`)
- Manual edits are preserved by scripts
- Validation happens at runtime via `siteConfig.js`

## Site Configuration (`content/site/site.json`)

Main site-wide configuration file.

### Structure

```json
{
  "site": {
    "title": "Site Title",           // Required: string
    "ownerName": "Owner Name",       // Required: string
    "tagline": "Optional tagline"    // Optional: string (default: "")
  },
  "theme": {
    "name": "mono"                    // Optional: "mono" | "paper" (default: "mono")
  },
  "nav": {
    "items": [                        // Optional: array (default: [])
      {
        "label": "home",              // Required: string
        "href": "/",                  // Required: string
        "enabled": true               // Optional: boolean (default: true)
      }
    ]
  },
  "social": {
    "items": [                        // Optional: array (default: [])
      {
        "label": "GitHub",            // Required: string
        "href": "https://...",        // Required: string
        "icon": "github",             // Optional: string
        "enabled": true               // Optional: boolean (default: true)
      }
    ]
  },
  "hero": {
    "headline": "Headline",           // Required: string
    "subheadline": "Subheadline",     // Optional: string (default: "")
    "layout": "default",              // Optional: string (default: "default")
    "images": [                       // Optional: array (default: [])
      {
        "src": "/hero/image-large.webp",  // Required: string
        "alt": "Alt text",            // Optional: string
        "caption": "7mm • f/1.8...",  // Optional: string
        "order": 1                    // Optional: number (for sorting)
      }
    ]
  },
  "favorites": {
    "album": {                        // Optional: object (default: null)
      "slug": "album-slug",           // Required if enabled: string
      "enabled": true                 // Optional: boolean (default: true)
    },
    "trip": {                         // Optional: object (default: null)
      "slug": "trip-slug",            // Required if enabled: string
      "enabled": true                 // Optional: boolean (default: true)
    }
  },
  "youtube": {
    "enabled": false,                 // Optional: boolean (default: false)
    "channelId": "UC...",             // Optional: string (default: null)
    "channelUsername": "@user",       // Optional: string (default: null)
    "channelName": "Channel Name",    // Optional: string (default: null)
    "apiKey": null                    // Optional: string (default: null)
  },
  "about": {
    "camera": {                       // Optional: object (default: null)
      "imageSrc": "/about/portrait-large.webp",  // Required if configured: string
      "title": "Title",               // Required if configured: string
      "subtitle": "Subtitle",         // Optional: string (default: null)
      "body": "Body text with \\n line breaks"  // Optional: string (default: null)
    }
  },
  "footer": {
    "enabled": true,                  // Optional: boolean (default: true)
    "credit": "Created by...",        // Optional: string (default: "© {year} {ownerName}...")
    "showSocialLinks": true           // Optional: boolean (default: true)
  },
  "seo": {
    "defaultTitle": "Site Title",     // Optional: string (default: site.title)
    "titleTemplate": "%s · Site",     // Optional: string (default: "%s · {title}")
    "description": "Site description", // Optional: string (default: "")
    "siteUrl": "https://...",         // Optional: string (default: "")
    "ogImage": "/og-image.jpg",       // Optional: string (default: "")
    "twitterHandle": "@handle",       // Optional: string (default: "")
    "robots": "index,follow"          // Optional: string (default: "index,follow")
  }
}
```

### Validation Rules

- `site.title` and `site.ownerName` are required (strings)
- `hero.headline` is required (string)
- `theme.name` must be `"mono"` or `"paper"` (whitelist)
- `nav.items[]` and `social.items[]` are filtered to enabled items with valid label/href
- `hero.images[]` are sorted by `order` field (ascending)

## Album Index (`content/albums.json`)

Summary index of all albums (generated by `rebuildAlbumsIndex.mjs`).

### Structure

```json
{
  "albums": [
    {
      "id": "album-slug",             // Required: string (same as slug)
      "slug": "album-slug",           // Required: string
      "title": "Album Title",         // Required: string
      "description": null,             // Optional: string | null
      "tags": ["tag1", "tag2"],       // Optional: array of strings
      "date": "2025-01-15",           // Optional: string (YYYY-MM-DD)
      "startDate": "2025-01-15",      // Optional: string (YYYY-MM-DD)
      "endDate": "2025-01-20",        // Optional: string (YYYY-MM-DD)
      "cover": "photos/album-slug/IMG_001-large.webp",  // Required: string
      "coverAspectRatio": 1.5,        // Required: number
      "count": 25,                    // Required: number
      "isFavorite": false,            // Optional: boolean (default: false)
      "primaryLocation": {            // Optional: object
        "name": "Location Name",      // Optional: string
        "lat": 40.123,                // Optional: number | null
        "lng": -111.456               // Optional: number | null
      }
    }
  ]
}
```

**Note**: This is a summary - does not include `photos[]` array. Load individual album JSON for full data.

## Individual Album (`content/albums/{slug}.json`)

Full album data including all photos (generated by `importPhotos.mjs`).

### Structure

```json
{
  "id": "album-slug",                 // Required: string
  "slug": "album-slug",               // Required: string
  "title": "Album Title",             // Required: string
  "description": null,                // Optional: string | null
  "tags": ["tag1"],                   // Optional: array of strings
  "date": "2025-01-15",              // Optional: string (YYYY-MM-DD)
  "startDate": "2025-01-15",         // Optional: string (YYYY-MM-DD)
  "endDate": "2025-01-20",           // Optional: string (YYYY-MM-DD)
  "cover": "photos/album-slug/IMG_001-large.webp",  // Required: string
  "coverAspectRatio": 1.5,           // Required: number
  "count": 25,                        // Required: number
  "isFavorite": false,                // Optional: boolean
  "primaryLocation": {                // Optional: object
    "name": "Location Name",          // Optional: string
    "lat": 40.123,                    // Optional: number | null
    "lng": -111.456                   // Optional: number | null
  },
  "photos": [                         // Required: array
    {
      "filename": "IMG_001.JPG",      // Required: string
      "path": "photos/album-slug/IMG_001-large.webp",  // Required: string
      "pathLarge": "photos/album-slug/IMG_001-large.webp",  // Required: string
      "pathSmall": "photos/album-slug/IMG_001-small.webp",  // Required: string
      "pathBlur": "photos/album-slug/IMG_001-blur.webp",    // Required: string
      "width": 6000,                  // Optional: number | null
      "height": 4000,                 // Optional: number | null
      "aspectRatio": 1.5,            // Required: number
      "lat": 40.123,                 // Optional: number | null
      "lng": -111.456,               // Optional: number | null
      "exif": {                       // Required: object
        "camera": "Canon EOS R5",     // Optional: string | null
        "lens": "RF 24-70mm f/2.8",  // Optional: string | null
        "aperture": "f/8",            // Optional: string | null
        "shutterSpeed": "1/250s",     // Optional: string | null
        "iso": 100,                   // Optional: number | null
        "focalLength": "50mm",        // Optional: string | null
        "dateTaken": "2025-01-15T12:00:00.000Z",  // Optional: string | null
        "copyright": null,             // Optional: string | null
        "artist": null,               // Optional: string | null
        "description": null          // Optional: string | null
      }
    }
  ]
}
```

### Data Preservation

- Scripts preserve existing photo data when merging
- Manual EXIF edits are never overwritten
- Custom tags and descriptions are preserved
- Only image paths and dimensions are updated

## Trip Definition (`content/trips/{slug}.json`)

Trip definitions that reference albums (manually created).

### Structure

```json
{
  "slug": "trip-slug",                // Required: string
  "title": "Trip Title",             // Required: string
  "dateStart": "2025-01-01",         // Required: string (YYYY-MM-DD)
  "dateEnd": "2025-01-10",           // Required: string (YYYY-MM-DD)
  "region": "Western US",           // Optional: string
  "summary": "Trip description",     // Optional: string
  "coverImage": "/photos/trip-cover.webp",  // Optional: string
  "useFirstAlbumCoverIfMissing": true,  // Optional: boolean (default: false)
  "albumIds": ["album-1", "album-2"],  // Required: array of strings
  "route": {                         // Optional: object
    "polyline": [                    // Optional: array of [lat, lng] tuples
      [40.123, -111.456],
      [40.234, -111.567]
    ],
    "gpxFile": "/trips/trip.gpx"     // Optional: string
  },
  "highlights": [                    // Optional: array
    {
      "id": "highlight-1",           // Required: string
      "title": "Highlight Title",    // Required: string
      "description": "Description",   // Required: string
      "date": "2025-01-05",          // Required: string (YYYY-MM-DD)
      "image": "/photos/highlight.webp",  // Optional: string
      "albumSlug": "album-1",        // Optional: string
      "photoFilename": "IMG_001.JPG",  // Optional: string
      "mapLat": 40.123,              // Optional: number
      "mapLng": -111.456             // Optional: number
    }
  ],
  "media": [                         // Optional: array
    {
      "type": "map-image",           // Required: "map-image" | "journal" | "video" | "artifact" | "gpx" | "collage" | "external-link"
      "src": "/trips/route-map.webp",  // Optional: string
      "caption": "Route map",        // Optional: string
      "title": "Map Title",          // Optional: string
      "href": "https://...",         // Optional: string (for external-link)
      "label": "Link Label"          // Optional: string (for external-link)
    }
  ],
  "miscImages": [                    // Optional: array
    {
      "src": "/photos/misc.webp",    // Required: string
      "caption": "Caption",          // Optional: string
      "tags": ["tag1"]               // Optional: array of strings
    }
  ]
}
```

### Trip Registry

Trips must be registered in `src/data/trips.js`:
```javascript
export const TRIP_SLUGS = ['trip-slug-1', 'trip-slug-2'];
```

## Map Data (`content/map.json`)

Generated file containing albums with GPS coordinates (for Globe component).

### Structure

```json
{
  "albums": [
    {
      "albumSlug": "album-slug",     // Required: string
      "albumTitle": "Album Title",    // Required: string
      "lat": 40.123,                  // Required: number
      "lng": -111.456,                // Required: number
      "photoCount": 25,               // Required: number
      "tags": ["tag1", "tag2"],       // Optional: array of strings
      "dateRange": {                  // Optional: object
        "start": "2025-01-15T00:00:00.000Z",  // Required: ISO string
        "end": "2025-01-20T23:59:59.999Z"      // Required: ISO string
      }
    }
  ]
}
```

**Note**: Only includes albums with valid GPS coordinates (lat/lng are numbers, not null).

## Showcase (`content/site/showcase.json`)

Showcase images for home page (generated by `processShowcase.mjs`).

### Structure

```json
{
  "images": [
    {
      "id": 1,                        // Required: number
      "type": "landscape",             // Required: "landscape" | "portrait"
      "side": "left",                  // Required: "left" | "right"
      "src": "/photos/showcase/IMG_4062-large.webp",  // Required: string
      "alt": "Showcase image 1",       // Optional: string
      "label": null,                   // Optional: string | null
      "location": "Tarangire National Park, Tanzania",  // Optional: string
      "exif": {                        // Optional: object
        "camera": "Canon EOS R5",      // Optional: string | null
        "lens": "RF 24-70mm",          // Optional: string | null
        "aperture": "f/8",             // Optional: string | null
        "shutterSpeed": "1/250s",      // Optional: string | null
        "iso": 100,                    // Optional: number | null
        "focalLength": "50mm",         // Optional: string | null
        "dateTaken": "2025-01-15T12:00:00.000Z",  // Optional: string | null
        "copyright": null,             // Optional: string | null
        "artist": null,                // Optional: string | null
        "description": null            // Optional: string | null
      },
      "dimensions": {                  // Required: object
        "width": 6000,                 // Required: number
        "height": 4000,                // Required: number
        "aspectRatio": 1.5             // Required: number
      },
      "order": 1                      // Optional: number
    }
  ]
}
```

## About Images (`content/site/about.json`)

About page images (generated by `processAbout.mjs`).

### Structure

```json
{
  "images": [
    {
      "src": "/about/portrait-large.webp",  // Required: string
      "alt": "About image 1",         // Optional: string
      "caption": null                 // Optional: string | null
    }
  ]
}
```

## Field Types

### Strings
- Titles, descriptions, labels, hrefs, paths
- Can be `null` if not available
- Examples: `"Album Title"`, `"https://example.com"`, `null`

### Numbers
- Dimensions (width, height), coordinates (lat, lng), counts, ISO
- Can be `null` if not available
- Examples: `6000`, `40.123`, `null`

### Booleans
- Flags: `enabled`, `isFavorite`, `showSocialLinks`
- Default to `true` if omitted (except where noted)
- Examples: `true`, `false`

### Arrays
- Lists: `tags[]`, `items[]`, `photos[]`, `albumIds[]`
- Can be empty `[]`
- Examples: `["tag1", "tag2"]`, `[]`

### Objects
- Nested structures: `exif`, `primaryLocation`, `route`, `favorites`
- Can be `null` if not configured
- Examples: `{ "lat": 40.123, "lng": -111.456 }`, `null`

### Nullable Fields
Many fields can be `null` when data is not available:
- EXIF fields (camera, lens, etc.)
- GPS coordinates (lat, lng)
- Descriptions, captions, labels
- Optional nested objects

## Schema Validation

### Runtime Validation (`src/lib/siteConfig.js`)

The site config loader validates required fields:

- **Required**: `site.title`, `site.ownerName`, `hero.headline`
- **Type Checks**: Validates string types for required fields
- **Whitelists**: Theme name must be `"mono"` or `"paper"`
- **Filtering**: Nav/social items filtered to enabled items with valid label/href
- **Defaults**: Optional fields use sensible defaults if missing

### Build-Time Validation

Scripts validate:
- JSON syntax (parse errors)
- Required fields for generated data
- File existence before processing

### Manual Validation

When editing JSON manually:
- Use valid JSON syntax (quotes, commas, brackets)
- Ensure required fields are present
- Use correct types (string vs number vs boolean)
- Check enum values (theme name, media types)

## Data Preservation

### Script Behavior

Scripts **never overwrite** manual edits:

1. **Album Photos**
   - Loads existing `albums/{slug}.json` first
   - Matches photos by filename or path
   - Preserves all existing fields
   - Only updates image paths and dimensions

2. **Albums Index**
   - Preserves `primaryLocation` if manually set with valid coordinates
   - Preserves `isFavorite` status
   - Syncs `isFavorite` back to individual album files

3. **Site Config**
   - Processing scripts only update image paths
   - Never overwrites text content, order, captions
   - User edits in JSON are source of truth

### Manual Edits

Safe to manually edit:
- EXIF data (camera, lens, descriptions)
- Tags, descriptions, dates
- Primary location coordinates
- Favorite status
- Hero/showcase image order and captions
- All text content in site.json

### Regeneration

To regenerate from source:
- Run processing scripts (they preserve manual edits)
- Use `--force` flag to regenerate WebP variants
- JSON structure is preserved
